version: 2
project_name: clearvault

before:
    hooks:
        - go mod tidy

builds:
    - id: clearvault
      main: ./cmd/clearvault
      env:
          - CGO_ENABLED=0
      goos:
          - linux
          - windows
          - darwin
      goarch:
          - amd64
          - arm64
      ldflags:
          - -s -w

    - id: clearvault-fuse
      main: ./cmd/clearvault
      env:
          - CGO_ENABLED=1
      tags:
          - fuse
      goos:
          - linux
      goarch:
          - amd64
          - arm64
      ldflags:
          - -s -w
      overrides:
        - goos: linux
          goarch: arm64
          env:
            - CGO_ENABLED=1
            - CC=aarch64-linux-gnu-gcc

archives:
    - id: archive
      format: tar.gz
      name_template: '{{ .ProjectName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}{{ if eq .BuildID "clearvault-fuse" }}_fuse{{ end }}'
      format_overrides:
          - goos: windows
            format: zip

checksum:
    name_template: "checksums.txt"

changelog:
    use: git
